{"rightSidebarLinks":[{"id":"authorization","title":"Authorization","subLink":null},{"id":"authorization","title":"Authorization","subLink":[{"title":"Role Based Authorization.","id":"rolebasedauthorization.","thirdLevelLink":[]},{"title":"Access","id":"access","thirdLevelLink":[]},{"title":"AllowAnonymous","id":"allowanonymous","thirdLevelLink":[]},{"title":"AllowAnonymousUser","id":"allowanonymoususer","thirdLevelLink":[]}]}],"title":"Authorization","description":"","validatorType":"decorators","validationTypeTitle":"Decorators","type":"simple","gitDocPath":"https://github.com/rxweb/rxweb.io/edit/master/docs/rx-web-core/security/authorization.md","category":"security","subCategory":null,"linkTitle":"authorization","tabArray":{},"innerHtml":null,"htmlContent":"<div class='row page-section' id= 'authorization'>\r\n<div class='col-lg-12'>\r\n<h1 class=title-level-1>Authorization</h1>\r\n\r\n<p class='showHideElement' ><span class='highlighted'>Authorization</span> is a method of adjudging which user is able to do what. It uses <span class='highlighted'>authentication</span> for identifying the user, It is done using role based authorization mechanism through which the access modules of the user is determined based upon role where rules are maintained in the database.</p>\r\n</div></div>\r\n<div class='row page-section' id= 'rolebasedauthorization.'>\r\n<div class='col-lg-12'>\r\n<h2 class=title-level-2>Role Based Authorization.</h2>\r\n\r\n<p class='showHideElement' >Role based authorization is a mechanism through which we determine that which user can have which acess for what module. For example, the admin user has the right to add elements, read elements, edit elements and delete elements and a non admin user has some specific rights based upon the user permissions which is managed in <span class='highlighted'>RolePermissions</span> table where Role is defined from <span class='highlighted'>Roles</span>.</p>\r\n<p class='showHideElement' >Roles Table:</p>\r\n<p class='showHideElement' >It contains various roles of the application which will be assigned to every user accessing the application.</p>\r\n<table class=\"table table-bordered\">\r\n<tr><th>RoleId</th><th>RoleName</th></tr>\r\n<tr><td>1</td><td>Admin</td></tr>\r\n<tr><td>2</td><td>HR</td></tr>\r\n</table>\r\n<p class='showHideElement' >RolePermissions Table:</p>\r\n<p class='showHideElement' >The roles and their respective permissions are stored in this table with its respective permissions of the read and write actions. If the user has one or more roles defined in the application, the permission priority is set accordingly for adjuding access rights.</p>\r\n<table class=\"table table-bordered\">\r\n<tr><th>RolePermissionId</th><th>RoleId</th><th>CanView</th><th>CanAdd</th><th>CanEdit</th><th>CanDelete</th><th>PermissionPriority</th></tr>\r\n<tr><td>1</td><td>1</td><td>True</td><td>True</td><td>True</td><td>True</td><td>NULL</td></tr>\r\n<tr><td>2</td><td>2</td><td>True</td><td>False</td><td>False</td><td>False</td><td>NULLs</td></tr>\r\n</table>\r\n<p class='showHideElement' >Based upon the RoleId and ApplicationModuleId it will retrieve the information about which user has how much access of which module based upon the role defined in Roles Table. </p>\r\n<p class='showHideElement' >The application module in <span class='highlighted'>RolePermissions</span> table is a FK reference from <span class='highlighted'>ApplicationModules</span> table</p>\r\n<p class='showHideElement' >ApplicationModules Table:</p>\r\n<p class='showHideElement' >A master module may have different modules which can be considered as child modules or sub-modules which are mapped into this table. Here the <span class='highlighted'>ParentApplicationModuleId</span> refers as a reference of the ModuleMasters table.</p>\r\n<table class=\"table table-bordered\">\r\n<tr><th>ApplicationModuleId</th><th>ModuleMasterId</th><th>ParentApplicationModuleId</th></tr>\r\n<tr><td>1</td><td>1</td><td>1</td></tr>\r\n</table>\r\n<p class='showHideElement' >The Module is defined in <span class='highlighted'>ModuleMasters</span> Table</p>\r\n<p class='showHideElement' >ModuleMasters Table: </p>\r\n<p class='showHideElement' >This table contains application modules which are defined during the start of the project.</p>\r\n<table class=\"table table-bordered\">\r\n<tr><th>ModuleMasterId</th><th>ModuleMasterName</th><th>StatusId</th></tr>\r\n<tr><td>1</td><td>Resource</td><td>1</td></tr>\r\n</table>\r\n<p class='showHideElement' >UserRoles Table : </p>\r\n<p class='showHideElement' >This table contains mapping of users and their respective roles.</p>\r\n<table class=\"table table-bordered\">\r\n<tr><th>UserRoleId</th><th>UserId</th><th>RoleId</th></tr>\r\n<tr><td>1</td><td>1</td><td>1</td></tr>\r\n</table>\r\n</div></div>\r\n<div class='row page-section' id= 'access'>\r\n<div class='col-lg-12'>\r\n<h2 class=title-level-2>Access</h2>\r\n\r\n<p class='showHideElement' >It is done using <span class='highlighted'>Access</span> in which id of the application module is passed. Through which it will execute authorization based upon which the user rights are determined.</p>\r\n<div class='model-ts'><pre><code>\r\n    [ApiController]\r\n    [Route(\"api/[controller]\")]\r\n\t[Access(1)]\r\n\tpublic class UsersController : BaseController&ltUser,vUsers,vUserRecords&gt\r\n    {\r\n        public UsersController(IUserUow uow):base(uow) {}\r\n    }\r\n</code></pre></div>\r\n<p class='showHideElement' >To add authorization in the controller using access, the following command is used:</p>\r\n<blockquote class='showHideElement' ><p>-- rxwebcore --controller --basic --main Users --uow --User --access 1</p></blockquote>\r\n<p class='showHideElement' >In this command <span class='highlighted'>Users</span> is the controller name, <span class='highlighted'>User</span> is the module and 1 is the application module Id retrieved from the database. </p>\r\n</div></div>\r\n<div class='row page-section' id= 'allowanonymous'>\r\n<div class='col-lg-12'>\r\n<h2 class=title-level-2>AllowAnonymous</h2>\r\n\r\n<p class='showHideElement' >When you want to by-pass the controller without any authorization when you want any user to access the specific action. For example: If you have a scenario where you want to by-pass the post action of registeration.</p>\r\n<p class='showHideElement' >As per the below scenario it will allow any user to access this <span class='highlighted'>Post</span> method and allow new user to register.  </p>\r\n<div class='model-ts'><pre><code>\r\n   [HttpGet]\r\n   [AllowAnonymous]\r\n   public async Task&ltIActionResult&gt Get()\r\n   {\r\n        var token = await ApplicationTokenProvider.GetTokenAsync(new vUser { UserId = 0, ApplicationTimeZoneName = string.Empty, LanguageCode = string.Empty });\r\n        return Ok(token);\r\n    }\r\n</code></pre></div>\r\n</div></div>\r\n<div class='row page-section' id= 'allowanonymoususer'>\r\n<div class='col-lg-12'>\r\n<h2 class=title-level-2>AllowAnonymousUser</h2>\r\n\r\n<p class='showHideElement' >When you want to by-pass the api without knowing whether who the user but authorization token is required, In other words adding <span class='highlighted'>AllowAnonymousUser</span> requires a authorization bearer before user logged in.</p>\r\n<div class='model-ts'><pre><code>\r\n        [HttpPost]\r\n        [AllowAnonymousUser]\r\n        public async Task&ltIActionResult&gt Post(AuthenticationModel authentication)\r\n        {\r\n            var user = await LoginUow.Repository&gtvUser&lt().SingleOrDefaultAsync(t => t.UserName == authentication.UserName && !t.LoginBlocked);\r\n            if (user != null && PasswordHash.VerifySignature(authentication.Password, user.Password, user.Salt))\r\n            {\r\n                var token = await ApplicationTokenProvider.GetTokenAsync(user);\r\n                return Ok(token);\r\n            }\r\n            else\r\n                return BadRequest();\r\n        }\r\n</code></pre></div>\r\n</div></div>\r\n"}